## 49.未来货币和区块链（二）
上期节目我们讲了，通过数字指纹和非对称加密技术，就可以确保消息的完整性和真实性，但是到此为止，去中心化账本的理想只实现了一半，并没完全实现，为什么呢？因为还有两个重大的问题没有解决。


第一个问题：账本同步问题。比特币网络中有那么多台电脑，一条交易信息发送出来的时候，当然不可能所有的电脑都开机，必然有一些处于离线状态，开了电脑也未必开着比特币客户端，所以总有一些电脑无法立刻收到这条信息。这样就会导致不同电脑上的记录不同步，到底以谁的电脑记录为准呢？


第二个问题：如何防止同一个比特币被重复使用呢？假如有一个黑客，他只有 1 个比特币，但是他却同时把这个比特币付给 A 和 B（虽然理论上无法真正的同时，但可以做到间隔时间极短），于是他就会在网络上广播两条信息，一条是支付给 A 的信息，一条是支付给 B 的信息，因为网速的关系，必然有的电脑先收到了信息 1，有的电脑先收到了信息 2，这就产生了矛盾，如何确定哪一条信息是有效的呢？


为了解决上面这两个难题，「区块链」技术横空出世，「中本聪」的论文真正在全世界掀起大风大浪的不是我们上一章介绍的比特币的基本工作原理，数字指纹和非对称加密都是成熟的技术。真正让中本聪一战成名的是「区块链」技术。但请记住：比特币不是区块链，它只是区块链技术的一个具体应用。


到底什么是区块链？它怎样巧妙地解决了账本同步和信息不重复的问题呢？


「中本聪」的总体思路是这样的：比特币网络中的所有电脑都只认可唯一的一个账本，任何一台电脑在接入比特币网络时，首先要同步这个唯一的账本，任何一台电脑想要往这个账本上写入新的信息，必须要完成一套繁琐的「手续」，这套「手续」复杂到几乎不太可能被同时完成两次，即便真的发生了巧合，被同时完成了两次甚至多次，也有一个规则可以判定哪条信息是合法的，哪条信息该被抛弃。


让我一步步为你揭开区块链技术的面纱。


为什么要叫「区块链」？因为中本聪把这个账本设计成了由一个个「信息包」首尾相连而成的长链，每一个「信息包」被称为一个「区块」，这些区块每一个都有唯一的编号（在比特币系统中，编号被称为高度（height）），这些编号就是自然数 1、2、3、4……一直往下排，不允许跳跃，也不允许中断和重复。


下面讲解区块的具体规则：


第一个区块当然是由区块链的发明人「中本聪」亲自创建的，那是北京时间 2009 年 1 月 4 日，在芬兰赫尔辛基的一台小型服务器上，第一个区块诞生了，这也被称作「创世区块」。在这个区块上，包含的主要信息是：


中间那段话是「中本聪」刻在第一个区块上的纪念，这是创世区块的特权，可以自己写一段话上去，但是从第 2 个区块开始，以后每一个区块就必须严格按照比特币系统的规则来创建了。区块的规则是：


区块链所有的奥妙就在尾巴上加的这个随机数上，因为它实在太奥妙，让我等凡夫俗子只能大呼过瘾，所以后面我就把它称为「奥数」，以方便讲解。


「中本聪」规定：这个新区块的数字指纹（一个 256 位的二进制数）的前 72 位必须全部为 0 。


回忆一下我们前面介绍过的数字指纹的知识。因为 SHA 算出来的指纹是毫无规律可循的一个数字，所以，想要满足「中本聪」的这个变态规定，唯一的办法就只能凭运气凑「奥数」，从 0 开始不断地去常试，直到满足要求为止。这就是一个纯粹的概率问题。我们来算一下要满足这个要求的概率是多大？


因为二进制数，每一位只有两种可能性，0 或者 1，所以，凑出一个奥数的可能性是 2 的 72 次方分之一，大约就是 4.7 万亿亿分之一。换句话说呢，就是平均要进行 4.7 万亿亿次 SHA 计算，才可能得到一个「奥数」，你可见每一个「奥数」的金贵。


最巧妙的是，「奥数」并不是某一个方程的解，解出一个少一个，因为每一个区块的字符串都不同，所以，每一次寻找奥数都需要从 0 开始，任何一个数字都有可能成为新的奥数，完全没有规律可循。


一旦成功找到了一个奥数，就获得了一次记账权力，可以给账本上新增加一个区块。那么，为什么要花时间找奥数，去给账本记账呢？因为好处实在太大了。比特币系统规定，每成功增加一个区块，这台记账的电脑（实际上是某个账号）就能获得 12.5 个比特币的奖励（截止到本文发稿时的奖金额），以及这个区块中所有交易的手续费，总额取决于交易频繁程度（平均约 2 比特币）。这样一来，相当于每找到一个奥数，可以获得 14.5 比特币奖励，按照本文写作时的比特币市场价，相当于 12 万美元。这么丰厚的奖励，自然就会吸引大量的电脑愿意去抢夺记账权。


寻找奥数就是抢记账权，抢记账权也就是挖比特币。因此，寻找奥数也被形象地称为「挖矿」。挖矿的电脑就叫「矿机」，一个装满矿机的房间当然就可以叫「矿厂」了嘛，矿厂的主人就是「矿主」，他们是比特币江湖中的弄潮儿。


但是，我需要给你解释一下挖矿的难度，让你打消去挖矿的冲动。个人电脑的运算速度大约是每秒可以进行 60 万次 SHA 计算，也就意味着，一台个人电脑需要花一千万年才有可能凑出一个奥数。当然，这是一种概率计算，我不能从理论上排除某人的人品超新星爆发，算了一次奥数就中了 4 万亿亿分之一概率的奖。但我还是想劝你不要相信自己是耶稣转世，你没有那个命。


我在《看看新闻》 2017 年 6 月 17 日的一个新闻中看到，记者采访了一个位于中国四川的矿厂，根据报道，这个矿厂有 5000 多台矿机的规模，平均每天耗电超过 20 万度，当地的电价是 3 毛每度，一天光是电费就 6 万多元，平均每天可以挖出大约 50 个比特币，一年左右回本，之后能做到 20% 左右的利润[ <http://www.kankanews.com/a/2017-06-17/0038034557.shtml> ]。不过我觉得这个报道中的数据前后矛盾，我查了一下，比特币当时的市场价是大约 2500 美金/个，美元兑人民币的汇率大约是 6.8 ，所以，每天的收入大约是 85 万人民币，一年的收入大约 3.1 亿元，一台矿机的成本均价是 1 - 2 万元， 矿厂的矿机总成本是 5000 万 - 1 亿元，再算上电费等，一年起码 2 亿的利润。我想，在充分市场竞争下，出现这种暴利的可能性很低。所以，不是记者搞错了，就是被采访对象在吹牛不打草稿。由于比特币的价格和全网算力的波动很大，所以投资比特币矿厂很难做长期预测，不确定因素太多。


根据我们前面掌握的比特币知识，50 个比特币，相当于找到了 4 个奥数，抢到了 4 次记账权。目前，整个比特币网络的所有矿机加起来的总算力能达到的水平，大约平均每 10 分钟可以找到一个奥数，也就意味着平均每 10 分钟生成一个新的区块。当然，这个 10 分钟是一个平均数，快一点的话 3、4 分钟生成一个区块，慢一点的话 15 分钟左右。


正因为奥数太难找，每个区块平均要 10 分钟才能生成一个，所以就能基本解决我在本章开头提出的第一个问题「如何同步账本？」，只要有个 3、4 分钟的时间，足以让所有在线的电脑同步到这个区块了，那些不在线的电脑或者第一次运行客户端的电脑，上线以后必须要先做一件事情，就是从相邻的节点上获取最新的账本。


请注意，我用了「基本解决」这个词，也就意味着，并没有完全解决「账本同步」的问题。这是因为总会有极小的概率两台矿机恰好同时（只要在网络上所有在线的节点没有完成区块链同步之前都可以算同时）找到奥数，也就意味着同时抢到了记账权。因为矿机实在太多了，这样的小概率事件时不时也会发生一次。同时抢到记账权的矿机都会将自己生成的新区块广播到比特币网络中。


遇到这种情况，比特币系统怎么处理呢？


在这种情况下，相当于网络上的其他节点收到了两个合法的新区块，因为网络节点的地域分布不同，所以，不同的节点收到这两个新区块的先后次序就会不同。此时，所有的节点会暂时保留两个新区块，并且把区块链做一个临时的分叉。


接下去，比特币网络中必然又会有其中一个节点（矿机）抢到了记账权，这时该节点就会将生成的最新区块接到其中的一个分支上，那到底是接到新区块 1 上还是 2 上呢？系统规则是：这个节点先收到哪个区块，就接到哪个区块上，同时放弃另一个区块，然后全网广播。 比特币网络上的所有节点在收到最新的区块链后，只要发现其中一个分支比另外一个分支多 2 个区块了，就立即也放弃那个短的分支，总之，比特币网络永远只承认更长的那条分支。你可能会想，那如果小概率事件再次发生，在区块链第一次分叉后，又是同时产生了两个新区块，而恰好两个新区块产生在两个不同的分支上，这时候，其他节点收到的区块链还是两个一样长的分支，那怎么办？很好办，还是同样的规则，只要分支一样长就暂时保留，直到出现两个分支不一样长时，就放弃短于 2 个区块的，保留长的。那个被放弃的分支中所有交易和比特币奖励都会被判定为无效。


因为有了这个临时分叉的规则，所以，比特币玩家在完成一笔交易后，不能立即认为这笔交易是成功的，有可能会被取消，必须要等到一定数量的新区块生成后，如果交易依然没有被取消，这才能放心地认为交易成功了。那到底要等到多少个新区块产生才能放心呢？按照概率来说的话，小额交易有这么三个新区块产生就够了，但是大额交易的话，为了更保险，一般认为是等到 6 个新区块产生，就足以放心了。前面说过，每个区块产生的平均时间是 10 分钟，也就意味着，一笔大额交易需要 1 个小时左右才能确认交易成功。


但是小额交易确认的时间往往会更长，甚至长达好几天。听到这个你可能会有点儿糊涂，刚才不是还说小额交易一般只要三个新区块产生就够了吗？怎么确认时间反而会更长呢？比特币网络刚刚诞生的头几年，确实不会出现这样的怪事，但是这几年随着交易量的猛增，就会出现这种怪事了。为什么？先回忆一下每个区块的规则：


你的交易记录要被写到区块链上，有一个前提：矿工将你的这笔交易记录打包到这个区块上。你可能想问：为什么会不打包？难道系统规则还允许不打包吗？打包成功了不是还要给矿工交税吗？矿工好不容易抢到一次记账权，怎么会有钱不赚呢？


是的，允许不打包。原因不是矿工不想赚钱，而是「不可抗力」，关键问题是每一个区块允许存储的数据量有限。中本聪当初设计比特币系统时，规定了每一个区块最大只能是 1MB，一条交易记录大概是 0.25K，那么一个区块最多可以储存 4000 多条交易记录，如果在一个新区块产生的时段中，发生的交易请求超过了 4000 条，那就肯定存不下了。我们可以算算，这个量大概是一个怎样的交易频率，每个区块的平均产生时间是 10 分钟，也就意味着，平均每秒钟的交易量如果超过 7 条，那么就一定会出现排队等待打包的交易记录了。这个交易频率实在很低，要知道支付宝一秒钟大约要处理上万笔交易。这一秒钟七笔交易对于全球来说，实在是太不够用了。


一般来说，大额交易优先打包，小额交易，手续费越高的交易越优先打包，打包规则矿工有一定的自主权。比特币交易手续费的规则比较复杂，不同的矿工收的还不一样，不是三言两语能说清。但有一点可能会让你感到诧异，越是大额的交易反而收费越低，甚至免费。交易额越小反而费率越高。这是因为，交易手续费除了鼓励矿工挖矿，还有一个非常重要的功能，就是防止有人恶意发布大量的小额交易造成信息拥堵。


现在，比特币交易滞留是非常普遍的现象，很多小额交易甚至等上好几天都确认不了，因此，很多人不惜附加很高的交易手续费来让矿工提前替他们打包。


好了，讲到这里，有关区块链的核心原理就讲完了，关键要记住，「中本聪」利用区块链技术，巧妙地解决了账本同步和信息不重复的问题，这就使得去中心化账本的理想最终得以实现。


有了这两期节目的知识打底，我们再来看本期《环球科学》上的文章就会有更加深入的理解。

