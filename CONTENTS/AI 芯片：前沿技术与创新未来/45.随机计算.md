## 45.随机计算
随机计算（Stochastic Computing）是一种使用随机二进制比特流进行计算的范式，这与 8.1 节中介绍的近似计算的出发点及应用场合比较接近，因为随机本身就是一种近似计算。 


随机计算最早是在 20 世纪 60 年代引入的，用于逻辑电路设计，但是其起源可以追溯到冯·诺依曼关于随机逻辑的开创性工作。在随机计算中，实数由通常按时序实现的随机二进制比特流表示，信息承载在二进制比特流的统计信息上。近年来随着量子计算的兴起，人们对于如何采用随机概率来进行计算有了很大的兴趣，因为量子计算就是一种基于概率的计算，它被认为是随机算术处理的一个典型例子。 


随机计算有着硬件简单性和容错性之类的优势，这在多种应用的数据处理中得到了证明，如图像处理、频谱变换、可靠性分析等。近年来它也出现在深度学习加速器 AI 芯片的应用中。随机计算的概念已扩展到系统、架构和应用级别的错误恢复设计机制中。 


随机计算的电路以比特流的形式串行处理数据。图 8.6 为二进制数转换成随机数的方式，即把给定的二进制数 B 转换为随机比特流形式。由一个随机数生成器生成随机二进制数 R，然后与 B 进行比较后采样，以每个时钟周期 1 比特的速率输出概率为 B/2  k  的随机数。在 N 个时钟周期后，它产生了一个 N 比特长的随机流 X，它的概率 P（X）约等于 B/2  k  。P 值是出现 1 的频率或速率，因此一个 P（X）的估计值可以简单地通过计算 X 中的 1 来估算，估计的准确性取决于 X 的位数的随机性及 N 的长度  [149]  。随机数生成器通常不是真随机源，而是采用逻辑电路，例如线性反馈移位寄存器（Linear Feedback Shift Register，LFSR），其输出是可重复的。 


![img](https://pic4.zhimg.com/v2-4664bae2d13dea439b63f75e3eaebb02.webp)

在随机计算中，一个随机数是通过对比特流中的 1 进行计数来表示一个实数。在单极格式（区间为  [0,1]  ）中，实数 x 由随机流 X 表示，满足 P（X=1）=P（X）=x。例如，比特流 1100101110 在 10 比特流中包含 6 个 1，因此它表示数字 P（X=1）=6/10=0.6。在双极格式（区间为  [-1,1]  ）中，可以用下式把单极格式转换成双极格式： 


![img](https://pic4.zhimg.com/v2-96cc231e048f78118ae78c43fa2aa428.webp)

从式（8.1）可以看出，实数可以由满足 2P（X=1）-1=2P（X）-1=x 的随机比特流 X 表示，因此 11011011111 可以表示 0.6。与传统的二进制逻辑相比，随机计算可以实现具有更小芯片面积、更低功耗和更短关键路径时延的电路，它还在容错方面具有优势。 


考虑到 DNN 的大多数运算是乘法，因此随机计算在实现 DNN 方面具有很大优势，因为随机计算中的单个与门即可以执行图 8.7 中单极部分所示的乘法。深度学习架构的应用中常采用双极格式，因为输入信号和权重可以为正数也可以为负数。双极格式的乘法用一个 XNOR 就可以实现，非常简单。双极格式中随机计算的乘法和加法实现方式如下。 


**1.随机计算的乘法**


对于双极格式，可通过一个 XNOR 门轻松实现乘法。图 8.7 中双极部分展示了使用 XNOR 门的 C=AB 的双极乘法过程  [150]  ，即 


![img](https://pic3.zhimg.com/v2-76611fe5608bddf7a46b251e86c97496.webp)

**2.随机计算的加法** 


加法的目的是计算输入随机比特流中 1 的总和。常用的加法硬件实现有两种：基于多路复用器的加法和基于近似并行计数器（Approximate Parallel Counter，APC）的加法。对于前一种结构，双极加法计算为 


![img](https://pic2.zhimg.com/v2-5843c9433c83069e217bc2d6f2b5394c.webp)

另一种方法是 APC 使用并行计数器对所有输入比特流中的 1 进行计数，并输出一个二进制数  [151]  。基于多路复用器的设计具有简单的结构，适用于少量输入的加法运算，但是当输入数量变大时，会表现出不准确性。基于 APC 的设计非常精确，适合大量输入，但电路结构更加复杂。 


随机计算已经被广泛用于设计深度学习 AI 芯片  [150,152,153]  。CNN 计算的一些关键部分，如乘法和加法、池化器及激活函数等，都可以使用随机计算的电路。研究人员选择了基于 APC 的加法（与基于 XNOR 的乘法器相结合）来实现内积运算，如图 8.8a 所示。当输入数量很大时，这种方法的精度很高；而针对最大池化操作有一种面向硬件的随机近似方法，它具有较低的硬件成本，并且不会产生任何额外的时延。 


更具体地，长度为 n 的输入比特流（内积）被划分为多个长度为 k 的比特段，因此在每个比特流中存在 n/k 个分段。然后为每个输入部署一个分段计数器及比较器，以对一个分段中的 1 进行计数，如图 8.8b 所示。使用分段计数器和比较器从输入 i 中找到当前分段所代表的最大数字，然后预测 i 为下一个分段中的最大值。 


这种以硬件为导向的设计通过计算所有输入比特流中的 1 的数量，以一种直接的方式来执行最大池操作，从而成功避免了额外的时延。另外，在基于随机计算的 DNN 设计中采用了 tanh 激活函数，因为它的实现比较简单并且具有相对较高的性能  [154]  。因为 APC 的输出是一个二进制数，所以这里采用了二进制 tanh 设计，它可以基于二进制输入来生成随机输出  [151]  。 


![img](https://pic3.zhimg.com/v2-1475f7d1b78d30b9aa720152bfc1e9db.webp)

随机计算的一个特点是无须修改硬件即可调整计算精度，这在其他计算系统中是无法实现的。例如，随机计算系统可以将 32 位和 1024 位（或任何位长）分别用于 1/32 和 1/1024 精度，而 10 位定点系统只能固定为 1/1024 精度。通过将随机计算的这一特点用于低精度操作，就可以大大降低能耗  [153]  。随机计算的优点还包括以下几个方面。 


（1）所需的逻辑资源非常小。例如，两数之间的乘法运算可简单地用一个二输入与门或 XNOR 运算来实现，具体取决于所采用的随机数格式；而加法器只需要一个多路复用器。这两种操作都可以用比它们的普通二进制运算电路少得多的硬件来实现，这对于 DNN 的硬件实现尤其重要。 


（2）固有的容错能力。由于采用随机数作为运算数据，其运算过程中的输入噪声或数据错误不会导致最终结果完全偏离。随机数的每个比特具有相同的重要性，而二进制数中比特的重要性则有很大的不同。此属性使随机计算通常可以非常好地避免「软错误」，因为比特翻转只会导致随机数数值的微小变化，而在普通二进制运算中，一个高有效位的比特翻转会导致重大错误。 


（3）随机计算的运算精度与比特流的长度相关，更长的比特流可产生更高的数值精度。 


也有研究人员直接在半导体器件级来实现随机计算，这些方法建议利用底层电路结构的固有概率行为，如最直观的是利用热噪声影响下的二进制开关的概率行为。基于这一原理，苏雷什·奇马拉瓦古（Sureh Cheemalavagu）等人提出了概率 CMOS（Probabilistic CMOS，PCMOS）系列电路  [155]  。 


由于随机计算采用的是一种随机方法，由随机电路执行的计算通常不精确，需要分析和管理这些不精确性。这还需要提高对随机计算的基本数学模型的理解。图 8.9 比较形象地表示了精确计算、近似计算、随机计算及计算出错之间的区别。 


![img](https://pic1.zhimg.com/v2-0b46f8d44af669693ba9e7b98256bb0e.webp)

  



备案号:YX01jbkWgwB9w7Lle

