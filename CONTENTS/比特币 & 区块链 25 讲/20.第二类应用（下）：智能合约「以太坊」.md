## 20.第二类应用（下）：智能合约「以太坊」
上节课我们了解了以太坊的起源、版本规划以及和以太坊相关的基本概念，这节课你将会了解以太坊的技术参数、它的发展情况、基于以太坊的区块链的知名项目，以及以太坊 ETH 和以太坊经典 ETC 的区别。


基本的参数上，我把以太坊和比特币进行下对比，这样可以更好的帮助你更好地理解。上一节课你了解了二者在区块链上的对比，这一节课你将了解比特币和以太坊上的代币以太币的对比。


在代币上，以太坊与比特币的最大的不同是它们的产量和总量的问题。比特币的产量每4年减半，而以太币的产量则是固定的。比特币的产量我们知道是
 2100 万枚，而以太币的总量到底是多少呢？这是一个有意思的故事，让我给你慢慢道来。


在 2014 年的时候，以太坊团队讨论后做了这样一个规定：以太坊先进行预售，预售结果是多少，我们就将其定为一个基准数，来规定以太坊发行的总量和每年的产量。假设在第一次预售中，预售了X枚以太坊，那么就会有另外
 0.99X 会新增出来分配给在预售之前参与开发的早期贡献者，另外一个 0.99X 以太坊新增发行出来分配给长期项目研究者。那么，在预售期就会有 X + 2 × 0.99X 枚以太坊被发行出来了。那么在以太坊发行预售之后，会采用工作量证明机制PoW来进行挖矿，它们规定每年发行的以太币数量是 0.26X。那么，这样的话就通过预售的这个 X 基准数决定了整个以太坊的总量和发行数量。


我们来去算一下，经过 2014 年 7 月 42 天的预售后，以太坊团队一共筹集了
 31531 个比特币，按照当时的价格是 1843 万美元，成为当时第二大的币众筹项目。当时出售的这个 X 的数量是 6 千万左右，也就是说在在预售阶段，就会有 6 千万 + 2 × 0.99 × 6千万，大约是 7200 万枚以太币就被发行出来了。那么在以太坊上线之后，每年会有多少以太币会被挖矿挖出来呢？那么，每年会有 6 千万× 0.26，大约是 1560 万左右的以太币会被矿工所挖出。听到这么多数字，你是不是有点晕呢？不用怕，课后对了文字内容看一遍，你很快就会理解的。


那么，我们接着往下聊。你可能会好奇：每年产生那么多以太币，矿工要怎么分呢？按照区块平分吗？当然不是了。


在讲怎么分配之前，这里要给你讲一个概念，以方便你的理解，就是以太坊区块链里的「叔块」的概念，叔叔的「叔」。「叔块」和「父块」概念是相对的。父块就是当前这个区块的上一个区块，这个比较好理解。叔块是什么意思呢？叔叔是父亲的兄弟，那么叔块也是父块的「兄弟区块」。


其实，以太坊的区块出块时间间隔非常短，只有 12 秒。我们知道 12 秒竞争记账，然后账本之间的同步，这么短的时间很容易出现分叉，矿工一时分不清哪个链是最长链，跟着非最长链后面记账的情况也是时有发生的。在比特币网络中，分叉出来的非最长链的区块叫 「孤块」，孤块是没有新生的比特币奖励的。但是对于快速出块的以太坊来说，如果孤块没有任何奖励，就会大大降低矿工们挖矿的积极性，因为挖到 「孤块」的概率也是非常大的。如果不给他们奖励的话，矿工的积极性就会收到影响，还会引发一定的社区混乱。所以在以太坊的区块链中，矿工们挖到了孤块，也是会获得区块奖励的，孤块很快就成为叔块，所以，以太坊网络还规定，每个区块对最近的2个叔块进行引用，每引用一个叔块的，将会得到一定的（1/32）的区块奖励，最多引用 2 个。


所以，以太坊区块的奖励会分给挖出区块的矿工，也会分给挖出孤块的矿工，加上前面说的预售的币和分给团队的币，组成了以太坊所有代币分配的构成。


这里我们不难发现，以太坊的总量在进入第四版本「宁静」之前，都是每年递增的，直到最后一个版本发布之后，才会恒定不变。


我们再来看看一些其他技术参数的对比。比特币的核心算法是 SHA256，以太坊的核心算法是 Ethash。区块的时间是比特币每 10 分钟出一个区块，而以太坊是 12-15 秒出一个区块。比特币区块的奖励目前是 12.5 个/每区块，以太坊是每个区块奖励 5 个以太坊。


从挖矿的收益角度，比特币矿工的收益包括挖矿的奖励以及在区块中的交易所产生手续费，而以太坊就复杂的多，除了和比特币一样挖矿的新生币奖励和手续费之外，还包括叔块奖励和引用叔块奖励。这里我们就要说到 Gas 这样的东西。


其实在以太坊当中，所有智能合约的运行是需要花费一定的费用的，这个费用就是用 Gas 去计费的。这里还要回过头来说 Gas 的概念，你还记得 Gas 是什么吗？Gas 是智能合约的开发者运行和建立智能合约所需要的花费，它是用以太坊来兑换的，Gas 最终要交付给矿工。就是说，开发者们在运行一个智能合约时需要向网络支付矿工一定的「手续费」，不过智能合约的手续费是由 Gas 完成的，Gas 用以太币来兑换，区块网络中每个 Gas 的平均价格是
 0.000000022 个以太币。


因为以太坊的区块链语言是图灵完备并且可编程的，所以有较好的使用基础，因此在区块链的应用开发上，很多企业和开发者选择了以太坊区块链作为底层技术。以太坊从 2015 年 7 月上线到 2017 年 9 月份，短短 2 年时间，全球已有 300 多个以太坊应用诞生。在以太坊上构建的应用，大多数应用的市值也都排在了数字资产市值的前列。截止 2017 年 9 月，Coinmarketcap 排名前 40 的市值，以太坊的应用已经达到 10 个。比如去中心化的预测平台
 Augur，还有全球算力 P2P 市场的 iEx.ec、用于分布式算力应用平台的
 Golem、用于黄金交易的 DigixDAO 等等，这些都是基于以太坊平台构建起来的。可见以太坊作为基础的应用，已经在全球逐步的风靡起来。


2017 年 2 月 18 日，企业以太坊联盟成立，成员包括摩根大通、芝加哥交易所集团、纽约梅隆银行、汤森路透、微软、英特尔、埃森哲等全球巨头，创始成员超过 30 家。到 2017 年 5月 22 日，三星、丰田等巨头加入，联盟队伍再次壮大，这将提升以太坊在区块链上的安全、拓展性等等，使之更符合企业对以太坊区块链技术的需求，并使之逐渐走向成熟。2017 年 5 月，联合国开始测试以太坊项目，并用于发放各国救援资金。2017 年 6 月 5 日，俄罗斯总统普京会见维塔里克·布特林；2017 年 8 月，俄罗斯国家开发银行宣布与以太坊达成战略合作。


在另外一个方面，2017 年春季，美国证券交易委员会默默启动了对以太坊
 ETF 的评估流程，研究是否批准以太坊的 ETF。每一份 ETF 份额相当于一个
 ETH 市值，投资目标是ETH的价格，获批之后将可以在二级市场进行交易，成交的价格有可能会等于、高于或者低于份额的净值，这也是以太坊 ETF 首次政府的评估，和比特币类似。


再来说说以太坊分叉，以太坊 ETH 和以太坊经典 ETC。你可能会特别奇怪，为什么会有这两个东西发生呢？以太坊的创始人为什么会亲自主持升级分叉，并且来进行分叉呢？为什么还会有人同意有人不同意，并且导致了硬分叉走了这么久并且还能并存这么久？其实，这恰好反映了去中心化社区的特点。在这个社区中，每个成员都有表达自己意志的权力和能力。2016 年 4~6 月，以太坊网络上规模最大的一次众筹项目 The DAO。DAO 是 Decentralized Autonomous Organization 的缩写，中文意思是「去中心化自治组织」。这个项目募集到了超过 1.5 亿美元的资金。然而，接近尾声时，The DAO 被黑客攻击了，近 6000 万美元的以太币被黑客盗走。此后，经过一系列争论，以太坊社区最终做出投票表决，大部分参与者同意更改以太坊代码，希望将资金从攻击者黑客那里夺回来。2016 年 7 月 20 日，以太坊的硬分叉实施。以太坊开发团队修改了以太坊软件的代码，在某一个区块上（第 1920000 区块）把The DAO 被黑客转移走的资金都退了回来，从而让黑客在原链上偷走的资金又重新回到了投资者的口袋里。


然而这一举动被另一部分人认为失去了去中心化的意义，不同意进行升级，仍然在原来的那条区块链上进行继续挖矿，由新的开发团队主导，于是就形成了我们今天看到的局面。


目前 ETC 的开发团队和社区也在计划升级 ETC 区块链，将会支持零知识证明，同时计划将 ETC 的总量由每年定量发布，改为像比特币一样，总量恒定、定期减产；ETC 总量不超过 2.1 亿个，每 500 万个区块减量 20%。在区块链的研发上，计划采用 Java 语言，区别于 ETH。


好了，这节课我们讲解了以太坊的基本参数、以太坊的发展现状以及 ETH 和
 ETC 的知识。通过本节课的学习，我们知道以太币的数量以及以太币的分配。在第四个版本之前，以太币的数量逐年增加，当以太坊进入到第四个阶段后，共识机制改变，每年新发行的以太币的数量还会再次发生改变，它的总量不是固定不变的。


我们还说到了，以太坊 ETH 和以太坊经典 ETC，就是因为太坊社区去中心化的特点，在众筹项目 The DAO 被黑客攻击丢失大量资金之后，一部分人同意更改以太坊代码将资金从黑客手中夺回来，另外一部分不同意更改，就形成了今天这样分裂的局面。


思考：如果你身处 2016 年 6 月，是以太坊的一个全节点或者矿工，你会同意为了追回被盗资金进行硬分叉吗？

