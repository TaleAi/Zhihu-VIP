## 12.高智商犯罪：如果那个节点遵守规则，我就不会亏损
「当时我看到以太坊创始人 Vitalik 突然发了一句话，说 The DAO 被黑客攻击了，钱正在被黑客拿走，我还以为是玩笑，然后我就懵了。」加密货币钱包 ImToken 的联合创始人 Daniel 说。


360 万 ETH，当时超过 6000 万美金，这是这场影响深远的黑客攻击事件的被盗金额。如果按照 ETH 的历史最高价格计算，360 万 ETH，价值接近 52 亿美金。


区块链，是一种技术，开发者中代码打造了一条没有单一节点可以控制的网络，供用户使用。而为了让参与人数增加，一条链的代码必须要开源。而开源，就意味着黑客也可以看见。所以，区块链网络其实非常考验开发者的技术，就好比一个金库，所有人都知道地点、金额和内部结构，只要你能找到安保的漏洞，就可以走进金库里取钱。这也导致，区块链网络上的黑客攻击事件频发。


今天为大家带来 3 个关于黑客攻击的故事，被盗的资金量在百万甚至千万美金级别 ，资金被盗多少并不是重点，重要的是事件发生后产生的深远影响。


这些故事有的是我们亲身经历，有的是我们从亲历者身上了解到了全貌。毕竟是真金白银，当我们把自己置身于当时的场景，才能体会到在这个几乎与现实隔绝的网络中，曾经发生过这些可以说多少改变了一些人生活的故事。


 


### 一、价值 6000 万美金的两行代码


直到现在，很多人在想起 4 年前加密行业这起黑客攻击事件时，估计还会心有余悸。


大家都知道比特币是一个安全地记录了所有转账记录的全球账本，可以实现无障碍的点对点转账，以太坊可以看做比特币的 2.0 版本，可以把它看做是一台「全球计算机」，开发者基于以太坊，可以高效、快速地开发出很多上层应用。 


在这样一个系统之上，很多致力于解决现实痛点的项目开始出现。当时，这种通过代码自行运作、不依赖个人主观意志的运作方式被很多人追捧，也是在这样的背景下，The DAO 诞生了。


它其实是由一家名为德国初创公司 Slock.it 发起的项目，这家公司当时做的是实体资产的上链业务，但因为很难在传统行业中融资，他们就萌生了一个大胆的想法：既然没人投自己，为什么不造出一个投资机构？


分布式自治组织的理念被他们引入，通过利用合约把一群利益相关者（投资人）把钱放到一起，如果有人拿着商业计划书来寻求融资，所有人投票决定是不是要投资，如果成功了，大家共享收益。


它整个过程，其实是这样运作的：用户向它提起希望获得投资的 proposal，在提案公示后，如果被超过半数以上的用户投票同意，那么这个虚拟「VC」就会拿出一笔钱，投给项目。被投项目需要保证将来其业务会通过这个合约连本带利，持续回馈给这个机构，而「VC」里的每个 LP 都能分到相应的收益。


The DAO 这种完全凭借智能合约运行的方式得到了社区追捧。项目在 2016 年 4 月底开启募资，不到一个月时间，就吸引了 11000 名投资者参与，最终成功募集了 1150 万枚以太坊，这么多数量的 ETH，占到了当时以太坊全网 15% 的流通量，总价值超 1.5 亿美元。也让 The DAO 成为了加密史上募集到以太坊数量最多项目。


但危险的种子，在项目融资大获成功的消息传出时，就悄悄埋下了。


当时，连团队都没想到，项目能融到那么多钱，自信的他们，把所有的 ETH 都放在一个地址里。这是一件非常可怕的事情，稍微有点常识的人都知道，如果你手上有巨额代币，最好是把代币分散存到多个地址，即便丢失了一部分，也不至于荡然无存。


木秀于林风必摧之。The DAO 成了别有用心的黑客攻击的「靶子」。


事实上，早在 2016 年 5 月份，以太坊团队成员就曾呼吁过，这类 DAO 项目可能存在安全问题，并给出了几种可能的攻击方案。6 月 11 日，以太坊另一个项目也发现合约就存在这样的问题，所幸处置及时，没造成损失。


不过，即使团队也收到同样的安全报告后，他们还是没引起重视，以为漏洞不会产生威胁。另外，当时已经有数十个提案等着投票，如果合约暂停进行查验，估计社区也不能接受。


就在所有人自以为万事大吉的时候，危险降临了。


黑客非常聪明，他先在 6 月 15 日悄无声息地写了一个攻击合约，安静地埋伏两天，直到 6 月 17 日才开始行动。利用合约的漏洞，黑客从主合约中成功转出了超 360 万枚 ETH，转入了一个 child DAO 中，这是一种递归式分割的方式，最终将收集到的币单次转走了。


出现问题的是下面两行代码：代码没错，就是顺序反了。


![img](https://pic3.zhimg.com/v2-23be71dcaacc821125bc3a792f9588b8.webp)

 


有人分析，如果程序员把两行代码的顺序上下换个位置，各个功能没有变化，但却能避免漏洞产生，没准 The DAO 就成功了。


当然，这也只是美好的幻想，黑客就是利用了这个漏洞，成功转移了 3 百多万枚 ETH，引起了加密社区的轩然大波。


这次攻击，让项目丢失了 360 万枚 ETH，按照当时的价格，总价值超过 6000 万美金，如果按 ETH 历史最高价计算，这笔丢失的资产近 52 亿美金。这个消息很快影响到二级市场，以太坊价格从 20 美金，跌破 13 美元，下跌幅度超 30%。


不过，狡猾的黑客没想到，因为 child DAO 的合约还处在创建阶段，有 27 天的锁定期，所以，他在短时间内也转不走这笔钱。


留给所有人的时间只有短短二十几天，大家必须在这笔钱被转走之前作出决策。


攻击发生后，Vitalik 发了文章，还原了 The DAO 被攻击细节，同时也给出了解决方案。他提议社区对以太坊区块链进行一次软分叉，把与之相关的交易认做无效交易，避免攻击者提走被盗的 ETH。之后，再发起一场硬分叉投票，再将这笔 ETH 找回来。


币还没转走，以太坊社区就放出了这么一个大招，黑客坐不住了。


6 月 18 日，这位自称主导了这场攻击的黑客现身，堂而皇之地发了一封致 The DAO 和以太坊社区的公开信，他表示，自己对社区定义他的行为是「盗窃」非常失望，声称他获得的 ETH 是合法并正当的，「我的律师事务所表示这样的行为完全符合法律」。 


![img](https://pic2.zhimg.com/v2-cb0ffc8b3d0dcd4be83053eff902fc0a.webp)

不过有人发现，他留下的签名是假的，所以这封公开信可能是有人伪造。


6 月 19 日，一位名为「daoattacker」的用户还在讨论该事件的 slack channel 出没，在一场匿名对话中，他表示会采取措施暂停有组织地对他财产的「盗窃」行为，「很快我们就会制定一个智能合约奖励那些不支持软分叉的矿工，共计 100 万枚以太币和 100 枚比特币。」试图怂恿矿工不支持分叉。有意思的是，他还给讨论区留下地址的人发了几枚 btc。 


「黑客」的意思很清楚：不认可以太坊分叉。不过，对于他的辩护，社区大多数人可不会理睬。


很快，以太坊社区发起了一项是否支持硬分叉的投票，近 97% 的 ETH 持有者投出了赞成票，只有少数人不同意分叉，最终硬分叉方案一致通过。


  


![img](https://pic4.zhimg.com/v2-d81282f2900fe74d85189f7620cbcb8b.webp)

 


2016 年 7 月 15 日，具体硬分叉方案公布，退币合约开始建立，由于 7 月 21 日是最终期限，硬分叉执行的最终期限确定，超过 85% 的算力支持硬分叉，以太坊硬分叉成功。


如今，我们在回顾这起加密世界的黑客攻击事件时，会发现这场攻击，不仅击垮了 The DAO，还有另一个更糟糕「副作用」：很多人开始怀疑，去中心化自治组织是不是空想，「Code is Law」到底是不是空中楼阁？以太坊社区确实是出于挽回大多数投资者损失的目前，发起了硬分叉投票，并终止了一场攻击的发生。


但从某个角度来看，「黑客」说的不无道理：The DAO 本身就是个智能合约，它的仲裁人是自己，任何其他外部节点都不能改变已经制定好的规则。而以太坊官方的做法则推翻了这种规则。


很多时候，引发黑客攻击的事件可以在开发者编写代码的过程中尽量避免，但加密世界的黑客，能利用的可不仅是一行行代码，还有人为治理中的漏洞。


### 二、节点作恶让我损失了 6000 万人民币


第二个故事，发生在一个叫 EOS 的项目上，这个项目身上曾有无数美誉， 「以太坊杀手」、「区块链 3.0」都曾经是它的标签。作为融资 42 亿美金，区块链历史上融资额最大的项目，人们对 EOS 的期待不言而喻。在 EOS 宣布上线前，行业内情绪高涨，甚至整个加密货币行业也被 EOS 带起了一轮小牛市。


广义上的节点作恶，其实是区块链网络上一种特有的攻击，区块链上的节点并非单一，同时以少数服从多数的原则，某些节点可以短暂控制整条网络以实现自己作恶的目的。「在主流区块链网络中，节点还没有作恶的能力。」 OKEx Research 首席研究员 William 表示，「不过在一些小的公链项目会有发生。」 William 所说的情况，在 2018 年曾经频繁发生，因为算力过于集中，攻击成本很低，2018 年发生过数次公链项目被攻击的情况。


但我们今天讲的故事，是另一种节点作恶。


讲黑客故事前，不得不提一下 EOS 史无前例的全球节点选举。任何一条网络都需要节点维护，单一节点维护就是我们常见的阿里、美团这样的互联网巨头，而区块链网络需要多节点维护，以保证网络安全。EOS 的网络节点只有 21 个，而这 21 个节点，是选出来的。


那是一场全球投票，选举的模式并不新颖，你完全可以理解成上学时班长的选举活动，但范围换成了全球，地点换成了线上。任何人，都可以给全球任何节点投票，只要你手里有 EOS。当时 EOS 的话题度，确实担得起 「以太坊杀手」的称号，起码在热度上碾压了当时的以太坊。


在 EOS 世界的畅想中，节点都是全世界的用户选出来，都是可以代表用户本身的，如果用户诚实地为节点投票，那么节点也必然是诚实的节点，是愿意做好事的节点，是愿意为网络发展做贡献的，是值得相信的。如果节点作恶，用户完全可以不为他们投票，这些作恶节点也就自然被淘汰出 21 名之外。


但事实证明，这个想法非常乌托邦，谁都不能阻止节点作恶。 


在 2019 年的 2 月 22 日，EOS 上发生了一笔离奇的转账，一个本不应该被使用的账户，转移了 209 万个 EOS，价值 6000 万人民币。黑客盗走了 6000 万人民币，并成功转走了。


按照 EOS 的规则，21 个节点必须统一设置黑名单，也就是一个限制转账的账户名单，只要在这个名单上的账户地址，就不能转账。而这个黑客的地址其实已经在黑名单上了，按理说不能完成赃款的转移，那么他是如何做到的呢？


在复盘过程时发现，问题出现在节点身上，一个节点是刚刚排上前 21 名没多久，自己疏忽大意，没有设置黑名单，我们叫它节点 A。按照 EOS 的网络规则，21 个节点轮流维护网络，每个节点维护的时间只有 6 秒钟。而黑客就是趁着节点 A 维护网络的 6 秒钟内，在没有黑名单限制的情况下，转走了 6000 万人民币。


再往深挖，发现这名黑客极具想象力。他这笔赃款完成转移需要两个前提：节点 A 被选进前 21 名，节点 A 没有黑名单。


巧的是，为什么节点 A 会突然被选进前 21 名？为什么黑客好像是提前就知道节点 A 一定会选进前 21 名一样？


其实，所有的一切都是黑客的一手策划。


我们知道，EOS 网络的节点是投票选举选出来的，只要你能排到前 21，你就可以即时当选并行使维护网络的权力。如果节点 A 不在列表中，那么黑客要做的，就是帮助它进前 21。最简单的办法，直接给他投票就好了。


于是，黑客在一个租赁市场中只花了几千人民币，就租到了 150 万个 EOS，完成了 150 万投票后，节点 A 顺利当选。


 


接下来，就是赌节点 A 没有设置黑名单，其实也很简单，节点 A 在此前就犯过类似的错误，换句话说，节点 A 的作恶是有历史的。所以以这个节点并不是一个好节点为前提，赌赢他们没有设置黑名单的概念非常大。


 


事实也证明，黑客赌对了，6000 万人民币的赃款，顺利转走，没有任何办法阻止。


 


而这起攻击其实也可以看作是 EOS 的正式没落，从融资 42 亿美金的高调，到真正落地后的失望，到安全问题频发。用户已经不再相信 EOS 可以改变什么了，甚至连用户的资产都不能保护。


就像 OKEx Research 首席研究员 Willam 说的，「在区块链网络中，节点应该做的事，就是专心负责记账，获得网络提供的报酬。」但是，这条融资 42 亿美金。承载的全球几乎所有加密货币投资者希望的网络节点，却连 「专心」这一件事，都做不好。


 三、失而复得的 2500 万美金
-----------------


这同样是一件必会被记录在区块链史册上的黑客事件。


今年 4 月的一个周六上午，Lendf.me 社群突然紧张起来，因为有人发现，Lendf.me 协议上的资产，全都不见了。


Lendf.me 是一个去中心化借贷协议，这在区块链行业中被划为一个单独的赛道—— 开放金融（Decentralised Finance，Defi）。用户使用这个协议可以自动实现借贷目的。去中心化借贷协议，其实与我们平常去向银行贷款本质上没有太大区别，都是上杠杆。有差异的地方在于借贷过程。


在银行贷款，比如比较常见的房贷，银行需要对贷款方进行全面评估，我们需要提供详细的资料，才能让银行判定我们有偿还能力，有申请贷款的资格，整体流程非常繁琐，一切是银行说了算。


但在去中心化协议中，不存在银行这种第三方机构，所有用户在以太坊这条网络上，都可以通过抵押资产获得贷款，比如可以抵押价值 1 万美金的 ETH，借出价值 7500 美金的美元代币。整体流程十分简单，几分钟就可以实现，没有机构从中获利，一切都是写在代码上的。人们在这段代码上存款，获得利息，同样在这段代码上借款，支付利息。


从好的方面看，这是一种技术上的创新，在金融领域上的全新体验，代码可以代替一家银行的业务；但从另一方面看，基于这段代码的平台，就是一个路上行走的钱包，稍有不慎，协议内的用户资产就有可能被黑客攻击转走。


就像 Lendf.me 身上发生的一样，2500 万美金的资产，荡然无存。


但接下来发生的事情，谁也没想到。平台与黑客在链上完成了一场不曾谋面，但惊心动魄的交锋，现在回想起当时所有在场的人的动作与情绪，依然能感受到这场被盗者从被动到主动过程中的激动。


这完全是一场好莱坞式的剧情。


在攻击发生后的 2 个小时，也就是 4 月 19 日的 11 点，Lendf.me 团队迅速集结了包括投资者、安全团队、交易所等众多机构的团队，以 24 小时不休的代价尝试找到黑客，同时保护平台内的其他资产。所有人的面部表情都是僵硬的，毕竟是 2500 万美金，这里面受到损失的用户有很多都是他们的朋友，压力之大可想而知。


当晚 22 点，第一个线索出现了，黑客在链上留下了两个单词 ：「Better Future」（祝你们有一个更好的未来），同时向平台地址先后转入了几百万美金，这部分钱似乎是他无法洗白的，拿着也没有用。从黑客轻蔑的语气就可以感知，他现在认为自己一手遮天，甚至开始施舍。


但就是这几笔转账，成为了寻找黑客的突破口，有人表示，黑客使用的网络泄露了关于他本人的重要元数据头部信息，让人们发现，黑客所有的转账都来自一个中国的 IP 地址。黑客根本没有使用洋葱网络之类的去中心化网络，这些信息暴露了黑客很多细节，包括黑客使用的电脑类型、屏幕分辨率、系统语言等等。


这成为了这起 2500 美金被盗事件的转折点。安全团队成功确定了准确的黑客画像，并开始与国内外各方资源交叉对比。虽然看不见他，但所有人都知道，与黑客的距离，越来越近。


终于，在发现了突破性线索后，安全团队开始主动，在 4 月 20 日下午，按照黑客喜欢的方式，安全团队在链上给黑客留下了信息：「Contact us. For your better future.」（为了你的美好前程，联系我们吧。）


使用了同样的 better future，但此时的心境已经完全不同，安全团队彻底掌握了主动，即便是黑客不回复，他们也可以与警方一起锁定黑客。


最终，21 日的下午，黑客在重重压力下，主动与平台沟通，2500 万美金悉数回归。


三天时间，在当事人的视角下，可能长如三年。


虽然这 2500 万美金的结局让人欣慰，但作为现在区块链唯一可以算的上是有潜力的应用的开放金融 Defi，频频发生的安全问题让不少希望尝试区块链应用的用户望而却步。OKEx Research 首席研究员 William 表示，除了安全问题，开放金融这种超前的思想还有不少问题，「用户体验不佳就是其中一种。」


现实世界的金融产品，大家都有了解，银行和理财公司推出的丰富金融产品大家已经司空见惯，不同资金量都有对应产品，用户也不可能因为产品过于复杂而放弃，用户门槛很低。但是区块链上的开放金融完全是另一个世界。 「相比于传统金融，开放金融要求用户熟悉钱包以及私钥等基本知识，门槛过高，对普通用户不友好。」Willam 表示。


而概念超前的开放金融真的可以替代我们现在的金融产品吗？可能也不一定。 在 OKEx Research 首席研究员 Willam 看来，将二者各自的优点结合，可能是未来金融发展的最大可能。


但不论如何，前提都是开放金融的安全问题不再出现。


备案号:YX01zxeBGkg0qLJnv


###### 2020-07-01 06:35
