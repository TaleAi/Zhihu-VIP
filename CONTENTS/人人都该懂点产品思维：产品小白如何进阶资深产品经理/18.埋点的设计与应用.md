## 18.埋点的设计与应用
任何事物的第一次似乎总是美好与遗憾并存。阿聪的产品改进上线也不例外，因为漏了埋点而在 QA 验收的过程中被打回，至少得延期一周上线了。 


看着阿聪垂头丧气的样子，我安慰道：「没事没事，百炼成钢哈。之前做过频道顺序调整的 A/B 测试，是复用已有的埋点和数据指标进行的。现在，咱们正好可以系统梳理一下埋点的设计与应用。只有科学设计的埋点才能更有效地支持 A/B 测试。」 


什么是埋点
-----


所谓埋点，就是在应用服务内预埋一些监测点，当用户的行为触发监测条件后，应用会向云端服务器发送相应的监测数据，产品服务以此来记录和统计相应数据。 


借由埋点，我们既可以记录用户在单个页面内的显性动作（如各种按钮的点击动作），也可以用于追踪用户的隐性行为（如停留时长、页面的浏览比例、页面的滚动行为、页面元素是否显示等）。通过在产品流程的关键环节和节点中引入埋点统计，可以统计出最核心的业务数据。进一步，通过会话（Session）的标记，我们可以串联多个埋点，追踪多个连续页面，从而知晓用户的页面访问路径和行为特点，进行各种维度的漏斗分析，以支持产品的改进和优化。 


  



![img](https://pic1.zhimg.com/v2-ab24bbbaaea96e34cdc76e7a37e3ce87.webp)

  



举一个常见的例子，很多电商网站的促销页面中，都会采用瀑布流的样式，自上而下排列多个促销或信息推介模块（如不同品类的促销信息，领券小游戏等互动模块）。 


在这样的单个页面内，可以通过调整各模块的呈现方式和模块布局来实现页面转化效率的最大化。想要更好地比较页面中各个模块的点击转化情况，至少需要支持以下三个数据。 


* 各模块的展示量
* 各模块的点击量
* 购买转化率（购买按钮点击到最后的成单情况）

为了构建这三个数据，我们在上述页面中需要的几类埋点有： 


* 埋点 0：进入页面的埋点
* 埋点 1：各个模块的展示事件埋点
* 埋点 2：各个模块的点击事件埋点
* 埋点 3：购买按钮的点击事件埋点

通过上述四类埋点数据的汇总，我们基本上可以覆盖这个页面的基础信息：整体页面的 UV，不同模块的展示和点击 UV，购买按钮的点击 UV。 


如果我们假设不同模块对于用户的购买决策有不同的影响作用的话，还可以进一步在埋点 3 中补充额外信息：当用户单击购买按钮时，页面展现到哪个模块。比如，是大咖推荐的模块让用户有购买动力，还是更丰富的课程数量让用户有购买动力，等等。 


在单个页面之外，我们还需要完成整个操作链路的记录，即用户会话。在上图中，活动页面是通过列表页的广告位（图左侧）引流而来的，活动页中的所有动作都会被赋予会话标志（SessionID），用户的行为会如下图所示： 


![img](https://pic3.zhimg.com/v2-5bf2e58cd0f257e8cd1062e496c59107.webp)

  



尽管在活动页内发生的浏览和点击、购买等行为类似，但是因为其上游的来源不同被赋予了不同的 SessionID。通过追溯 SessionID，我们可以清晰地了解哪个渠道带来的点击转化效果更好。 


数据，是产品经理迭代过程中最好的朋友。更好地收集数据、理解数据，离不开产品经理对于业务埋点的熟悉，知道要制定哪些埋点，关注哪部分埋点。 


网页和客户端如何进行埋点
------------


埋点大体可以分为网页埋点和客户端埋点两种，均有较为成熟的第三方工具可以使用，以下分别进行介绍。 


首先是网页统计。如果我们把一个网页比作一个商铺，那么我们关心的就是：有多少人来了、有多少人走了（页面访问的记录），这些人在商铺里看了什么、体验或买了什么（用户的浏览行为、点击行为记录）。网页统计可以使用如百度统计、Google Analytics（GA）或友盟（前 CNZZ）等工具。三者都提供了页面访问的记录（PV、UV）和用户行为事件的记录两大类功能。 


页面访问的埋点方法比较简单： 


1. 在工具平台上注册账户，填写自己网站的基础信息。 


2. 生成对应的 JavaScript 脚本（样例如下）。 


3. 在自己的网页中引入对应的 JavaScript 脚本。 


![img](https://pic3.zhimg.com/v2-06e42e27f207ebe9dd3c327ee064fec8.webp)

页面访问统计脚本工作的原理是：在你的网站页面加载时，将下载并执行 https∶//s96.cnzz.com/z\_stat.php 这一脚本： 


* 脚本以参数「id=xxxx, web\_id=yyyyy」来识别 PC 站的身份。
* 在页面打开时进行触发，上传相应参数，记录时间戳。
* 在页面关闭时进行触发，上传相应参数，再次记录时间戳。

由此，就完成了一次网页的访问统计操作。 


用户行为动作的事件统计略微复杂一些，会在用户和页面的元素（各种浮层、按钮、链接）发生交互的时候向服务器发送动作的统计请求。如下图，当用户点击简书网站上的各种功能按钮（喜欢、赞赏支持、更多分享）时，将会向统计服务器发送信息。 


![img](https://pic4.zhimg.com/v2-52de3d330c327caa654930855f06ddc2.webp)

  



各工具平合对此的记录方式类似，在对应元素的交互逻辑中，插入追踪代码。 


![img](https://pic4.zhimg.com/v2-2e57090a7547e46fffe86c04d9c49814.webp)

在元素被触发的时候，就会调用这个 \_trackEvent（）方法，传递以下参数。 


* category：交互事件发生的对象类型，即动作发生在哪一类对象上，在简书场景下，比如文章、专栏、个人页等。
* action：动作本身的描述，如上图中的喜欢、赞赏支持、更多分享。
* label：用来进一步补充动作对象的信息，如文章标题、专栏名字等。
* value：通常用来记录数值型动作的信息，比如豆瓣网站的打分动作。
* nodeid：div 元素 id，选填项，填写网页中的 div 元素 id 值。

一个调用例子如下： 


![img](https://pic3.zhimg.com/v2-dd28bce475593d1667ff5175db8de26c.webp)

接下来，我们继续看看如何对手机应用进行埋点。应用的埋点和网页的埋点思想类似：在每个页面进入和离开时发送统计事件（类比为网站页面的统计），在用户有各种行为动作的时候发送统计事件（类比网站的行为事件记录）。 


如果利用第三方工具来实现埋点的话，在应用启动时，首先注册 SDK。 


![img](https://pic1.zhimg.com/v2-1f97c19f542bc6a2a097940e10a24e16.webp)

在打开某个页面或离开某个页面时进行记录。 


![img](https://pic1.zhimg.com/v2-452f6ffb0f73a4cb74abb569ca6dba72.webp)

在用户发生各种动作时，将会触发自定义的动作。 


![img](https://pic2.zhimg.com/v2-9bc373587932f0556c63f9f4183d1fe1.webp)

埋点的规范与设计
--------


埋点，并不是孤立的单页面需求，而是一个需要团队作战贯穿整个业务线、串联多个页面的综合需求。这也就给埋点的制定提出了规范化的要求。 


各大公司都有专门的团队负责埋点事宜，制定埋点规范，协调不同业务部门同学遵守相同埋点规范进行设计，在研发同学完成埋点后进行验收，再产出数据分析报告，最后例行化到日常报表当中。以 LinkedIn 为例，该公司组建了一个 27 人的团队，只为做一件事情，在工程师、产品经理和分析师之间规范打点标准。随便一个分析需求，这个团队就需要花上几个星期去定义规范，最后才是开发、测试、上线等后续流程。 


由于埋点的设计是为了合理地追溯、便捷地统计，我比较赞同 GrowingIO 的拆解方法，它们将数据拆分为 4W1H：时间（When）、地点（Where）、人物（Who）、内容（What）、行为（How）。 


其中，时间、人物是标准化数据，会贯穿于埋点始终。 


产品经理在自己的业务场景里，主要需要关注的是 2W1H：Where、What 和 How 的问题，即用户在哪个页面，针对哪个对象，进行了哪个动作。并根据动作的具体特点，补充动作的额外信息 Extra\_Value。 


如果你在简书 App 中阅读一篇文章，那么可能的 Where、What 和 How 就是： 


![img](https://pic4.zhimg.com/v2-b24ee4dae3b4c0426a91f664b1e60f7a.webp)

在这 2W1H 中：每个页面（Where 的部分）都拥有独立的 ID，并记录自己的上游来源（From\_ID）。由于动作会跨越不同对象（What）和页面（Where），因此需要遵循全局的 Extra\_Value 标准。以分享动作为例，分享对象的不同，如文章或作者会带来 What 的不同，分享渠道的不同，则可以作为动作补充的信息（Extra\_Value）。 


按照 Where→How→What 的顺序来梳理，通常能够较完善地梳理出埋点的信息，做到不重复、不遗漏。 


聚焦核心数据和主要路径，防止过埋点
-----------------


在实际工作中，我们追求的是快速迭代和产研规范化中的平衡。我个人的建议是：在实验方案上的初版埋点设计中，只关心主要的变化指标和主要的分析路径即可，切勿过埋点！ 


通过核心指标，我们能够评估出方案的优劣，通过主要分析路径的追溯，我们可以在核心指标不达标的情况下，找到可能的优化路径。而这一切，都只需要少数几个埋点就能够覆盖。 


在工作中我们常会见到的情况是：一个三级页面里的每一张卡片、每一个按钮都被事无巨细地记录下来。从合理性上还算说得过去，但是从必要性上呢？恐怕就值得商榷了。 


如前文中一再强调，埋点是为了服务产品迭代和重要信息收集的。如果一个埋点你压根儿就没打算看，或者是其上一级的父操作就非常稀疏，那么子埋点就压根儿没必要收集了。以活动购买页为例，如果没有加入「转发打折」或「拼团打折」的功能，你觉得会有多少用户自发主动地选择转发呢？在产研周期紧张的情况下，在这个页面中加入各种完善的埋点意义究竟有多大呢？ 


埋点规范是服务人的，而不是人服务规范的。关于埋点，我知道最惨痛的案例是：一个功能上线时设计了几十个埋点，可是上线一周后，连主收益都没有拿到，只能落得黯然下线的命运，那几十个埋点都没来得及看数据就全数作废了。 


如何确定一个更合理的埋点集合呢？我们可以在确定埋点集合之前与研发工程师、数据分析师进行充分的沟通，依次明确下述几个问题。 


* 产品和业务迭代的主要诉求是什么？（为了降低复杂度，我们通常建议一次迭代只服务于一两个诉求。）
* 有哪些值得关注的产品假设？（大家其实都会有一些关注点，比如增加了某个功能可能会有什么连带反应？）
* 需要哪些数据来支撑产品主诉求和产品假设的追溯和分析？
* 这些数据需要哪些埋点来支撑？
* 参考公司标准，有哪些基础埋点需要补充？

从核心需求倒推埋点，可以让我们收敛到一个必要却又不过设计的埋点集合。在埋点方案确认后，拉上研发工程师和数据分析师充分沟通，才可以让埋点的需求方、设计方与实现方对需求达成一致认知，避免理解不到位而造成的返工与延期。在完成功能开发后，埋点的测试与功能的测试同样重要：功能有问题自然不能上线，埋点有问题则如盲人摸象，上线了也需要回滚。只有在合理、正确的数据埋点支撑下，才可以得到有参考意义的结果，让每一次上线都有数据支持。 


调整过埋点后，阿聪的项目二次上线了。 


好在虽然有波澜，但项目的 A/B 测试表现正向，不至于第一个项目就落得折戟沉沙的命运。 


「你这下真算是有了完整的上线体验了。评审、开发、上线、回滚，一个没落下。下周约个会，再安排一下复盘吧。」我道。 


「得了您嘞。」 


备案号:YX01W1dyn6MOMrNWw


###### 2020-07-03 11:28
