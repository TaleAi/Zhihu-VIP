## 57.用于解决组合优化问题的 AI 芯片
量子退火方法是一种基于伊辛模型的方法。这个模型发明之后，有不少学者和教授进一步对这个模型作了改进和发展，作出了很多贡献  [183, 184]  。虽然伊辛模型已经作为量子计算机的新模式用于量子退火机，但是量子计算机不但需要昂贵的超低温冷却设备，在量子比特的稳定性和扩展方面也存在问题。因此，一些半导体芯片开发厂商想到以量子现象的思想来实现计算机体系结构，做成量子启发的数字退火芯片。 


数字退火受一种被称为「叠加」的量子现象启发，其中 0 和 1 两种不同的状态同时出现。通过使用基于该现象的量子比特机制，数字退火的操作速度得到显著提高。数字退火可以基于现今的半导体工艺高速解决组合优化问题。例如，数字退火在 CMOS 数字电路上再现这种量子比特机制，操作速度快，使用非常简单，不需要像传统计算机那样进行编程，可以简单地通过设置参数来执行计算。 


近年来日本一些公司采用量子启发的思路，基于伊辛模型，已经用 FPGA 或 ASIC 实现了 CMOS 数字退火芯片。日本日立（Hitachi）在 2016 年就发布了 CMOS 退火芯片；日本国立情报学研究所（National Institute of Informatics，NII）则一直在研发基于光学参量振荡器（Optical Parametric Oscillator，OPO）的激光网络加 FPGA 的退火解决方案；日本富士通（Fujitsu）成功实现了 DAU 芯片，该芯片成为世界上第一款在常温下工作的商用数字退火芯片，2018 年富士通声称准备在 2020 年批量生产 DAU。这款芯片将被置入服务器里，放在传统机架和服务器机房里都不成问题，因为这些芯片和普通芯片一样可以在常温下工作。 


如果使用 CMOS 电路实现伊辛计算，芯片就易于制造、使用和扩展。伊辛计算还可使用随机化方法来防止陷入局部最小值，因此通常会找到问题的全局最小值。 


#### 基于 FPGA 的可编程数字退火芯片


由于 FPGA 具有高度灵活性，因此很适合用于那些有不同应用需求的数字退火芯片。电路拓扑和动态范围的要求因应用而异，因此每个应用都需要开发一个合适的架构。下面介绍的是一个基于 FPGA 的可编程数字退火芯片原型。 


这个架构的基本思想是使用电子电路模拟伊辛模型，如图 10.3 所示。自旋和伴随系数（即图 10.3 中左下的「系数」）组成一个自旋单元。每个自旋单元都有一个存储单元阵列来表示自旋和系数。自旋的下一个状态由数字或模拟运算电路决定。自旋单元根据所需伊辛模型的拓扑连接在一起。 


![img](https://pic4.zhimg.com/v2-fbd59cbd3cfd2fc8e29c268fa923cbb0.webp)

基于上述架构实现的处理器被用作解决组合优化问题的加速器。首先把表示优化问题的系数值写入存储器单元。然后，通过更新自旋值重复执行自旋单元之间的相互作用。运算电路通过相邻的自旋值和相应的系数来确定下一个自旋状态，以找到能量局部最小值。更新意味着运算电路的最新输出，存储在表示自旋的存储器单元中，然后相邻自旋单元可以观察输出。如与更新冲突，这意味着自旋单元使用同时更新的自旋值，则必须加以避免。 


为了防止发生这种冲突，可在交互期间控制更新顺序。自旋单元可以组合成一个棋盘图案并按顺序更新，通过更新自旋实现的相互作用达到局部最佳状态。这样可以找到能量低于当前值的状态。然而，一旦状态陷入局部最优，就不可能再改进解决方案。因此，需要向运算电路添加随机行为以使计算能够从局部最优点逃逸出来，这需要加入伪随机数生成器来实现随机行为。 


在这种 FPGA 的架构实现中，还可以加入很多方法来改进解决方案的准确性和拓扑的复杂性。例如，架构可以实现为基于具有多个自旋单元，并且自旋共享一个运算符以降低资源消耗。此外，产生用于退火的随机脉冲序列的伪随机数发生器也在所有单元之间共享。这样，又可以把逻辑器件的数量减少到小于原来的 1/10，并且解决方案精度与在传统计算机上运行的模拟退火相当。另外，架构中系数的动态范围一般是 2 位宽，它代表 +1、0 和-1 的值。在实际使用中，需要加宽到至少 4 位或 5 位。 


以上介绍的是一种基于 FPGA 原型来实现伊辛模型的架构。也有研究人员提出了几种基于 FPGA 的特定用途计算机来加速伊辛模型的蒙特卡洛模拟，但他们的目标是进一步研究物理学，而不是解决优化问题。搜索伊辛模型的最低能量状态基本上等于图论中的加权最大割（Max-Cut）问题。最大割问题是非确定性多项式时间 NP 难度类型的问题。 


有的研究人员还研究了用光学参量振荡器组成的激光网络来解决组合优化问题。 


#### 使用 OPO 激光网络来进行最优化计算


这种方法由 OPO 激光网络和 FPGA 组成，需要全连接（由 FPGA 处理）和激光振荡器。美国斯坦福大学、加州理工学院、康奈尔大学、哥伦比亚大学，日本 NII 及日本电报电话公司（NTT）的研究人员已经对此进行了很多研究，各自采用了不同的改进方法，并冠以不同的名称，如相干伊辛机  [186，187]  、量子神经网络等，但基本原理是一样的。 


OPO 由泵浦激光器、非线性晶体和光学谐振腔构成。强大的泵浦光场与晶体发生二阶非线性光学相互作用，将某个频率的激光转换为两个较低频率（信号和空闲频率）的相干输出波，并形成与泵浦光相当的功率输出。例如，利用 OPO 转换频率的特性，可将近红外 1 μm 激光转换成 1.5～5 μm 相干光。 


OPO 的特殊情况是简并 OPO。在这种情况下，输出波频率为泵浦频率的 1/2，即信号波和空闲频率波具有相同的极化。对于某些参考光来说，OPO 产生的光可以是完全同相或完全异相，这正好可以用来代表二进制的上下自旋状态，即可以将自旋表示为来自 OPO 的光与参考光同相的条件。相反，如果是异相的，则进行了一次自旋。 


简并 OPO 的这种非常规操作机制适用于解决伊辛问题，并且可以通过扩展来解决许多其他组合优化问题。形式上，N 个自旋的伊辛问题需要找到自旋的配置 σ  i  ∈{-1， +1}（i=1, 2, …, N），达到能量函数 H 最小化，其中要解决的特定问题实例由 N×N 矩阵 J（含元素 J  i  j  ）和 N 维矢量 h 指定（含元素 h  i  ）。在简并 OPO 伊辛机中，向上旋转和向下旋转由正、负同相幅度表示，即 σ  i  =X  i  /| X  i  |。然后，通过在两个 OPO 之间实现与 J  i  j  成比例的互耦并将与 h  i  成比例的 DC 场注入到单个 OPO，将能量函数 H 映射到 OPO 网络的有效损耗和光子衰减率。 


伊辛模型的基态对应于具有最小网络损耗的振荡模式。在低于振荡阈值的泵速下，每个 OPO 处于压缩真空状态，其被解释为 σ  i  =+1（正振幅或向上旋转）和 σ  i  =-1（负振幅或向下旋转）的线性叠加，因此 2  N  个自旋配置的概率幅度都是相同的。在阈值泵浦速率下，当 OPO 网络增益增加并达到基态的最小损耗率时，在基态发生单模振荡  [187]  ，这将触发光子的受激发射和其他所有模式的交叉增益饱和。这就是相干伊辛机的基本原理，如图 10.4 所示。因此，通过简单地检测单个振荡模式可以找到组合优化问题的解决方案。 


![img](https://pic1.zhimg.com/v2-4a68fa351e153cfcb088098aca414891.webp)

所有 OPO 的输入状态都是真空状态。基本量子操作是在 OPO 阈值处的集体（非个体）对称性变动，以相关方式将所有 OPO 转换为正幅度或负幅度相干态。最后，通过光学零差检测器读出计算结果并把结果输入 FPGA。FPGA 计算出基于自旋的估计值，并通过光调制器把光脉冲反馈到 OPO。这种基于测量反馈的伊辛机允许任何自旋和任何其他自旋间的连接，并且是完全可编程的。 


通过 FPGA 可以实质上耦合所有的光脉冲，目前耦合的最大数量为 400,000。运行开始时，通过把待解决问题的约束信号添加到正负值重叠的 FPGA 的特定脉冲上，脉冲的正负排列收敛到特定的值。由于每次光脉冲通过相敏放大器时执行纠错，因此只需存在与待解决问题的数量一样多的光脉冲就足够了。日本 NTT 在 2019 年春把量子比特数增至 10 万个，并在函数中导入了外部磁场项。 


还有一些研究人员把基于 OPO 的伊辛机模型作了进一步的扩展，认为使用任何非线性自维持振荡器都可以实现类似的伊辛机，可以把逻辑值编码到其相位中。这些类型的振荡器包括 MEMS（Micro-Electro-Mechanical System）振荡器、CMOS 振荡器、光电纳米器件振荡器等  [188, 189]  ，可使用双稳态锁相实现基于相位的逻辑编码和存储。这些类型的振荡器容易实现大规模集成，成为一种能够高速、低功率运行的新型 AI 芯片。 


#### CMOS 退火芯片


日本日立的研究人员提出了一种使用 CMOS 来仿真伊辛模型的方法。因为伊辛模型要求将自旋状态表示为二进制值，所以这些状态存储在半导体静态随机存取存储器（SRAM）中。表示自旋对之间的相互作用强度的交互系数，和表示外部磁场强度的外部磁力系数也存储在 SRAM 中。类似地，通过数字电路的操作来复制导致自旋值改变的相互作用。 


为实现此目的，每个自旋由图 10.5 所示的电路表示。这包括存储自旋状态、相互作用系数、外部磁场系数的存储器电路，以及计算相互作用的数字电路。每次自旋都有相邻的自旋。每个相互作用具有系数 I  x  （x=U、L、R、D、F）。N 是自旋值，N  U  、N  L  、N  R  、N  D  和 N  F  是来自相邻自旋的值。伊辛模型的每次自旋也受外部磁场的影响，需要加入外部磁力系数，代表外部磁场的影响。 


![img](https://pic3.zhimg.com/v2-6066bac946df4ee5e854deff8ac647ff.webp)

为了降低系统能量，相邻自旋之间的相互作用通过以下规则实现： 


（1）受相邻的 5 个自旋和外部磁场的影响； 


（2）如果 a＞b，新的自旋值为 +1；如果 a＜b，新的自旋值为-1；如果 a=b，新的自旋值为 +/-1。这里 a 是假定值为（+1, +1）或（-1, -1）的连接对 N  x  的数量；b 是假定值为（+1, -1）或（-1, +1）的连接对 N  x  的数量。新的自旋值在存储器中更新。 


对所有隔离的自旋同时执行该更新过程，意味着伊辛模型中任何自旋次数的增加都与同时更新的自旋次数的变化相匹配，因此自旋的总次数对自旋状态更新所花费的总时间（即计算伊辛模型收敛所花费的时间）几乎没有影响。 


为了实现这些规则，这款 CMOS 退火芯片使用了 XOR、开关电路和多数表决电路，通过比较由串接晶体管放电的预充电线的电压值来执行 XOR 和多数表决的功能。根据公开信息，这款 CMOS 退火芯片使用 65nm 工艺制造，自旋数为 20,000 个（见图 10.6），裸片面积为 4 mm×3 mm=12 mm  2  ，包含了 2.6×10  5  个 SRAM 单元（自旋值为 1 bit），量子比特数为 2000～4000  [191]  ，互动频率为 100 MHz。 


![img](https://pic1.zhimg.com/v2-afc49a3a458a6ee7ac704762566947b7.webp)

图 10.7 为使用这款芯片解决最大割组合优化问题的优化过程（100 万个计算迭代）。当能量函数 H 达到了最小值时，设置为 ABC 的系数值显示出最佳状态。据称这款芯片的能效比传统 CPU 要高 1800 倍。 


![img](https://pic2.zhimg.com/v2-eb3959659bb4fb9a73ace959e4a85d28.webp)

这款芯片基于采用邻近连接而不是全连接的伊辛机原理，需要事先进行软件处理。 


CMOS 退火芯片使用的是普通的数字电路，因此与传统的量子退火机和使用超导器件的相干伊辛机相比，所得到的解决方案的精度会较差。但是，这已经满足一般应用的需求。从易用性和可扩展性的角度来看，用 CMOS 来实现退火芯片具有工程和经济方面的双重意义。 


#### 商用量子启发 AI 芯片


为了解决组合优化问题，日本日立、富士通、NTT、NII 等公司和机构已经发布了基于量子启发的 AI 芯片。 


富士通在 2018 年东京论坛大会上发布了全球第一款商用的量子启发芯片，称为数字退火处理器（Digital Annealer Unit，DAU），能提供 8192 量子比特的计算能力（远高于谷歌在实验室中打造的 72 量子比特），精度从 16 位扩展到 64 位。富士通在 2020 年推出了 DAU 专用计算机系统，目标是提供 100 万位的大规模平行处理能力，也就是可以快速算出一个变量多达 100 万个的多项式方程的最优解。DAU 不同于一般专用处理器，是一个可以用来解决超大规模组合优化问题的专用 AI 芯片。 


DAU 芯片（见图 10.8）是一块全连接的大型 FPGA，配置了基于伊辛模型的电路。富士通也在 2018 年 5 月正式推出了数字退火云端服务，可以用来处理 1024 位等级的超大规模组合优化问题（意味着可计算多达 1024 个变量的多项式方程组），让企业可以先用云端服务来解决过去难以处理的超复杂组合优化问题。 


![img](https://pic4.zhimg.com/v2-103358e977ee2a1a9c38510f35429cbb.webp)

最新加入这种量子启发 AI 芯片研发竞争的是日本东芝。该公司开发了一种名为模拟分岔（Simulated Bifurcation，SB）算法的新算法，用于解决组合优化问题，并在专业期刊上发布了详细信息  [192]  。 


东芝在 FPGA 中实现了这个算法，并将最大割问题作为一个组合优化的例子（最大割问题可以从数学上转换成其他组合优化问题），与 NTT 和 NII 的结果进行了比较。根据该结果，东芝的 FPGA 在只需要约 1/10 时间的情况下，获得了与 NTT 和 NII 的结果只有很小差异的解，每解答一次只耗时 0.5 ms。此外，东芝开发了 SB 算法和实现它的机器，与其他模拟退火机器或量子退火机器相比，在可用变量的数量及其应对全连接方式方面也是有优势的。 


如上文所述，在基于模拟退火的算法中，为了避免陷入局部最优值而不能达到全局最优值，常常需要在降低温度的同时，不断采用随机或非随机的方法对温度作一些「扰动」，也就是有时适当提高一下温度。这样可以让解决方案「跳出」快要陷入的最小值内。而东芝研发的 SB 算法不需要作这样的「再加热」，也可以达到全局优化。 


SB 算法受到使用非线性振荡器网络的量子绝热优化的启发。SB 算法的核心是对原来的能量函数 H 进行微分，具有绝热过程中遍历过程的属性。绝热过程的特征在于，当系统参数缓慢转换时，微分方程的解继续保持低能量。跟踪 SB 算法中每个组合优化解的变化（一种概率分布）可以用来代替模拟退火中的再加热过程。它虽然不使用量子力学性质，但可以说它利用了接近某种量子隧道的效果，尽管它在经典力学范围之内。 


东芝使用单个 FPGA 实现了基于 SB 算法、全连接 2000 个自旋的超快速伊辛机，其速度比最新的相干伊辛机快 10 倍。该公司还使用一个 GPU 群集 SB 机器解决了带有连续权重的、100,000 个节点的最大割问题，比最快的模拟退火算法快 10 倍。 


如果基于模拟退火算法，操作的主要部分是乘积累加运算，需要的计算量约为 O(N  2  )，而如果基于模拟分岔算法，按照东芝的说法，实现并行化以后已经可以把计算量降到 O（N）规模以下。 


备案号:YX01jbkWgwB9w7Lle

